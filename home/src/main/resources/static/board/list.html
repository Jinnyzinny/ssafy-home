<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시판</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <!-- Common Header -->
    <div id="header"></div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10 col-sm-12">
                <h2 class="my-3 py-3 shadow-sm bg-light text-center">
                    <b class="sky">게시판</b>
                </h2>
            </div>
            <div class="col-lg-8 col-md-10 col-sm-12">
                <div class="row align-self-center mb-2">
                    <div class="col-md-2 text-start">
                        <button type="button" id="btn-mv-register" class="btn btn-outline-primary btn-sm">글쓰기</button>
                    </div>
                    <div class="col-md-7 offset-3">
                        <form class="d-flex" id="form-search">
                            <select id="key" class="form-select form-select-sm ms-5 me-1 w-50" aria-label="검색조건">
                                <option value="">검색조건</option>
                                <option value="article_no">글번호</option>
                                <option value="subject">제목</option>
                                <option value="user_id">작성자</option>
                            </select>
                            <div class="input-group input-group-sm">
                                <input type="text" id="word" class="form-control" placeholder="검색어...">
                                <button id="btn-search" class="btn btn-dark" type="button">검색</button>
                            </div>
                        </form>
                    </div>
                </div>
                <table class="table table-hover">
                    <thead>
                        <tr class="text-center">
                            <th scope="col">글번호</th>
                            <th scope="col">제목</th>
                            <th scope="col">작성자</th>
                            <th scope="col">조회수</th>
                            <th scope="col">작성일</th>
                        </tr>
                    </thead>
                    <tbody id="article-list">
                        <!-- Articles will be dynamically added here -->
                    </tbody>
                </table>
                <div class="row" id="pagination">
                    <!-- Pagination will be dynamically added here -->
                </div>

                <button type="button" class="btn btn-outline-primary btn-sm" onclick="location.href='/'">홈페이지</button>
            </div>
        </div>
    </div>

    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
    loadBoardArticles();

    // 검색 버튼 클릭 시
    document.getElementById("btn-search").addEventListener("click", function () {
        const key = document.getElementById("key").value;
        const word = document.getElementById("word").value;
        loadBoardArticles(1, key, word);
    });
});

// 게시글 데이터를 가져오는 함수
function loadBoardArticles(pgno = 1, key = '', word = '') {
    const url = `/api/board?pgno=${pgno}&key=${key}&word=${word}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            renderBoardArticles(data.articles);
            renderPagination(data.navigation, key, word);
        })
        .catch(error => console.error("게시글 불러오기 오류:", error));
}

// 게시글을 테이블에 렌더링하는 함수
function renderBoardArticles(articles) {
    const articleList = document.getElementById("article-list");
    articleList.innerHTML = '';

    if (!articles || articles.length === 0) {
        articleList.innerHTML = `<tr><td colspan="5" class="text-center">검색 결과가 없습니다.</td></tr>`;
        return;
    }

    articles.forEach(article => {
        const row = `
            <tr class="text-center">
                <th scope="row">${article.articleNo}</th>
                <td class="text-start">
                    <a href="#" class="link-dark" onclick="viewArticle(${article.articleNo})">${article.subject}</a>
                </td>
                <td>${article.userId}</td>
                <td>${article.hit}</td>
                <td>${article.registerTime}</td>
            </tr>`;
        articleList.innerHTML += row;
    });
}

// 페이지네이션 버튼 렌더링
function renderPagination(navigation, key, word) {
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = '';

    if (navigation && navigation.navigator) {
        navigation.navigator.forEach(page => {
            const button = document.createElement("button");
            button.className = "btn btn-sm btn-light";
            button.textContent = page;
            button.onclick = () => loadBoardArticles(page, key, word);
            pagination.appendChild(button);
        });
    }
}

// 게시글 상세 페이지로 이동
function viewArticle(articleNo) {
    location.href = `/board/view?articleNo=${articleNo}`;
}

    </script>
</body>

</html>
